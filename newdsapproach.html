<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
    margin: 0 !important;
    padding: 0 !important;
    flex-shrink: 0 !important;
    scrollbar-width: none;
    
}
.page {
    position: relative;
 overflow: hidden;
height: 100dvh;

}

.background {
 
position: relative;
display: flex;
align-items: center;
justify-content: center;
height: var(--page---H);
width: var(--page---W);

}
.background img {
  position: absolute;
  width: 100%;
  min-height: 100%;
}
.card {
  position: absolute;
  z-index: +1;
  top: 50%;
  right: calc((var(--background---H) - (var(--background---H) / 1.1)) / 2);
  transform: translate(0% , -50%);
  height: calc(var(--background---H) / 1.1);
  width: calc((var(--background---W) / 2) - (var(--background---H) - (var(--background---H) / 1.1)));
  background-color: rgb(255, 255, 255 , 0.9);
  border-radius: calc(1dvh + 1dvw);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.welcome-back {
  position: absolute;
  left: calc((var(--background---H) - (var(--background---H) / 1.1)) / 2);
  z-index: +1;
  top: 50%;
  transform: translate(0 , -50%);
  width: calc(var(--background---W) - (var(--card---W) + (((var(--background---H) - (var(--background---H) / 1.1)) * 1.5))));
  flex-direction: column;
  display: flex;
  align-items: center;
  justify-content: center;
  height: var(--card---H);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  color: white;
  
}
.welcome-back * {
  text-align: center;
}
.welcome-back h1 {
  font-size: calc((var(--background---H) + var(--background---W)) / 40);
  
}
.welcome-back h2 {
  font-size: calc((var(--background---H) + var(--background---W)) / 105);
}
.logo {
  height: calc(var(--card---H) / 4);
  width: 100%;
  
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.logo img {
  width: calc((var(--logo---W) + var(--logo---H)) / 6);
  max-height: calc(var(--logo---H) / 1.1);
}
.logo h1 {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  font-size: calc((var(--logo___img---H) + var(--logo___img---W)) / 3);
  color: #0092dd;
}
.input {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: calc(var(--card---W) / 1.2);
  height: calc(((var(--card---H) - (var(--card__logo---H))) / 10) - 1px);
  border-bottom: 1px solid black;
  margin-bottom:  calc((var(--card---H) - (var(--card__logo---H))) / 50) !important;

}
.input input {
  font-size: calc((var(--input---W) + var(--input---H)) / 35);
  width: calc(var(--__input---W) - var(--__input___h1---W));
  height: calc(var(--input---H) / 2);
  text-indent: 1ch;
  border: none;
  outline: none;
  background-color: transparent;
  font-weight: 400;
}

.input h1 {
  max-width: calc(var(--__input---W) / 3);
  max-height: 100%;
  overflow-x: scroll;
  white-space: nowrap;
  
  font-size: calc((var(--input---W) + var(--input---H)) / 35);
 font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
 font-weight: 600;
 margin-left: calc(var(--card---W) / 50) !important;
}
/* 
.input input {
  width: calc((var(--input---W) - var(--input___h1---W)) - (var(--card---W) / 50));
  height: calc(var(--input---H) / 2);
  text-indent: 1ch;
  border: none;
  outline: none;
  background-color: transparent;
  font-size: calc((var(--input---W) + var(--input---H)) / 35);
  font-weight: 400;
}
*/
/* 
this uses closest syntax
.input input {
  width: calc((var(--__input---W) - var(--__input___h1---W)) - (var(--card---W) / 50));
  height: calc(var(--input---H) / 2);
  text-indent: 1ch;
  border: none;
  outline: none;
  background-color: transparent;
  font-size: calc((var(--input---W) + var(--input---H)) / 35);
  font-weight: 400;
} */

.login-btn {
  height: calc(var(--card---H) / 15);
  width: calc(var(--card---H) / 7.5);
  font-size: calc(((var(--card---H) / 7.5) + (var(--card---H) / 15)) / 7);
  border: calc(((var(--card---H) / 7.5) + (var(--card---H) / 15)) / 50) solid rgb(9, 85, 129);
  outline: none;
  background-color: #0092dd;
  border-radius: calc(0.3dvh + 0.3dvw);
  color: white;
  font-family: Arial, Helvetica, sans-serif;
  font-weight: 600;
  cursor: pointer;
  
}
/* .input {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: calc(var(--card---W) / 1.2);
  height: calc(((var(--card---H) - (var(--card__logo---H))) / 10) - 1px);
  border-bottom: 1px solid black;
  margin-bottom:  calc((var(--card---H) - (var(--card__logo---H))) / 50) !important;

}
.input h1 {
  max-width: calc(var(--input---W) / 5);
  max-height: 100%;
  overflow-x: scroll;
  white-space: nowrap;
  
  font-size: calc((var(--input---W) + var(--input---H)) / 35);
 font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
 font-weight: 600;
 margin-left: calc(var(--card---W) / 50) !important;
}
.input input {
  width: calc((var(--input---W) - var(--input___h1---W)) - (var(--card---W) / 50));
  height: calc(var(--input---H) / 2);
  text-indent: 1ch;
  border: none;
  outline: none;
  background-color: transparent;
  font-size: calc((var(--input---W) + var(--input---H)) / 35);
  font-weight: 400;
}
.login-btn {
  height: calc(var(--card---H) / 15);
  width: calc(var(--card---H) / 7.5);
  font-size: calc(((var(--card---H) / 7.5) + (var(--card---H) / 15)) / 7);
  border: calc(((var(--card---H) / 7.5) + (var(--card---H) / 15)) / 50) solid rgb(9, 85, 129);
  outline: none;
  background-color: #0092dd;
  border-radius: calc(0.3dvh + 0.3dvw);
  color: white;
  font-family: Arial, Helvetica, sans-serif;
  font-weight: 600;
  cursor: pointer;
  
} */

    </style>
</head>
<body class="page" id="page">
<section class="background">
<img src="https://images.unsplash.com/photo-1687197180710-b2b9484a3c5f?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="" srcset="">
</section>
<section class="welcome-back">
<h1>Welcome back!</h1>
<h2>We are happy to see you again!</h2>
</section>
<section class="card">
<section class="logo">
  <img class="logo-img" src="https://i.postimg.cc/XN1dXPCj/image-removebg-preview.png" alt="" srcset="">
  <h1>Lumex</h1>
</section>

<section class="input">
  <h1>Email</h1>
  <input type="email">
</section>
<section class="input">
  <h1>Password</h1>
  <input type="password">
</section>
<section class="input">
  <h1>Password</h1>
  <input type="password">
</section>
<section class="input">
  <h1>Password</h1>
  <input type="password">
</section>

<button class="login-btn">
Login
</button>

</section>


<script>
function buildSelectorFromChain(selectorChain) {
  return selectorChain
    .replace(/___/g, " ")
    .replace(/__([a-zA-Z0-9_-]+)/g, " .$1")
    .replace(/^([a-zA-Z][\w-]*)/, ".$1"); 
}

function measure(targetEl, property) {
  if (!targetEl) return null;
  switch (property) {
    case "H": return targetEl.clientHeight + "px";
    case "W": return targetEl.clientWidth + "px";
    default:  return null;
  }
}

function setPageHeight() {
  const pg = document.getElementById("page");
  if (pg) pg.style.height = window.innerHeight + "px";
}

const varBindings = new Map();

function init() {
  setPageHeight();
  const rx = /var\(\s*--([^)]+)\s*\)/g;

  for (const sheet of document.styleSheets) {
    let rules;
    try { rules = sheet.cssRules; } catch { continue; }
    if (!rules) continue;

    for (const rule of rules) {
      if (!rule?.style) continue;

      for (const prop of rule.style) {
        const value = rule.style.getPropertyValue(prop);
        if (!value) continue;

        if (!value.includes("--__")) {
          let m;
          while ((m = rx.exec(value))) {
            const varName = m[1].trim();
            if (varBindings.has(varName)) continue;
            const [selectorChain, property] = varName.split("---");
            if (!selectorChain || !property) continue;
            const selector = buildSelectorFromChain(selectorChain);
            let el;
            try { el = document.querySelector(selector); } catch { el = null; }
            if (!el) continue;
            varBindings.set(varName, { selector, property, element: el });
          }
        } else {
          const regex = /var\((--[^)]+)\)/g;
          const matches = [...value.matchAll(regex)].map(m => m[1]);
          const uniqueVars = [...new Set(matches)];
          let elements = document.querySelectorAll(rule.selectorText);

          // Batch reads
          const readValues = uniqueVars.map(uVarRaw => {
            let propertyType = uVarRaw.endsWith("---H") ? "H" : "W"; 
            let uVar = uVarRaw.replace("---H","").replace("---W","");
            let raw = uVar.substring(2);
            let tokens = raw.match(/(?:_{2,3}[A-Za-z0-9-]+)|[A-Za-z0-9-]+/g) || [];
            return { uVar, tokens, propertyType };
          });

          elements.forEach((element) => {
            let finalInlineValue = value;

            readValues.forEach(({uVar, tokens, propertyType}) => {
              let parts = tokens.map(t => t.startsWith('___') ? t.slice(3) : t.startsWith('__') ? '.' + t.slice(2) : '.' + t);
              let closestElement = element.closest(parts[0]);
              for (let i = 1; i < parts.length; i++) closestElement = closestElement.querySelector(parts[i]);
              if (!closestElement) return;
              let varValue = propertyType === "H" ? closestElement.clientHeight : closestElement.clientWidth;

              // Build dynamic variable
              let chunks = rule.selectorText.trim().split(/\s+/);
              let firstClassUsed = false;
              let convertedSelector = chunks.map(token => {
                if (token.startsWith(".")) return firstClassUsed ? "__" + token.slice(1) : (firstClassUsed = true, token.slice(1));
                if (token.startsWith("#")) return token;
                return "___" + token;
              }).join("");

              let dynamicVar = "--_-_-_" + convertedSelector + "_var_" + uVar + "_var__---_E0_---_" + (propertyType==="H"?"---H":"---W");

              // Check existing max E
              let matchedVars = [...document.documentElement.style].filter(v =>
                v.startsWith("--_-_-_" + convertedSelector + "_var_" + uVar + "_var__---_E") &&
                v.endsWith(propertyType==="H"?"---H":"---W")
              );
              let maxE = Math.max(-1, ...matchedVars.map(v => { let m=v.match(/E(\d+)/); return m ? parseInt(m[1],10):-1;}));
              dynamicVar = dynamicVar.replace(/E\d+/, `E${maxE+1}`);

              // Apply write AFTER all reads
              document.documentElement.style.setProperty(dynamicVar, varValue + 'px');
              finalInlineValue = finalInlineValue.replace(uVar + (propertyType==="H"?"---H":"---W"), dynamicVar);
            });

            element.style.setProperty(prop, finalInlineValue);
          });
        }
      }
    }
  }

  finalize();
  finalize();
  finalize();
  
}

function finalize() {
  const updates = [];

  // Read all values first
  for (const [varName, { property, element }] of varBindings) {
    const val = measure(element, property);
    if (val) updates.push({ name: `--${varName}`, value: val });
  }

  for (let rootStyle of document.documentElement.style) {
    if (!rootStyle.startsWith("--_-_-_")) continue;

    let fullName = rootStyle;
    let selectorChain = (fullName.match(/_-_-_(.+?)_var_/) || [])[1];
    if (!selectorChain) continue;

    let tokens = selectorChain.match(/(?:_{2,3}[A-Za-z0-9-]+)|[A-Za-z0-9-]+/g) || [];
    let addressSelector = tokens.map(t => t.startsWith("___") ? t.slice(3) : t.startsWith("__") ? "."+t.slice(2) : "."+t).join(" ");

    let elements = document.querySelectorAll(addressSelector);
    let indexMatch = fullName.match(/_---_E(\d+)_---_/);
    let elementIndex = indexMatch ? parseInt(indexMatch[1], 10) : null;
    let element = elements[elementIndex];
    if (!element) continue;

    let uVarMatch = fullName.match(/_var_(.+?)_var_/);
    let uVar = uVarMatch ? uVarMatch[1] : null;
    let propertyType = fullName.endsWith("---H") ? "H" : "W";

    let raw = uVar.substring(2);
    let tokensEle = raw.match(/(?:_{2,3}[A-Za-z0-9-]+)|[A-Za-z0-9-]+/g) || [];
    let parts = tokensEle.map(t => t.startsWith('___') ? t.slice(3) : t.startsWith('__') ? "."+t.slice(2) : "."+t);

    let closestElement = element.closest(parts[0]);
    for (let i=1;i<parts.length;i++) closestElement = closestElement.querySelector(parts[i]);
    if (!closestElement) continue;

    let varValue = propertyType==="H"?closestElement.clientHeight:closestElement.clientWidth;
    updates.push({ name: fullName, value: varValue+'px' });
  }

  // Apply writes after all reads
  updates.forEach(u => document.documentElement.style.setProperty(u.name, u.value));
}

window.addEventListener("DOMContentLoaded", init);
window.addEventListener("resize", () => { setPageHeight(); finalize(); });

const observer = new MutationObserver(() =>
 finalize()
);
observer.observe(document.body, { childList:true, subtree:true, attributes:true });
</script>


</body>
</html>
<!-- build up this login form to see if it is right or not -->
 <!-- 
three "___" means look inside by tag
two "__" means look inside by classname
---H / ---W
stands for height and width
 -->




 <!-- 
 task to do-----------------------------------------------------

1) Look at the error and debug and find how that error is caused and why


 .input  input ma width set karo closest syntax sa
 jis sa clost .input ki width ma sa - kar do closest .input___h1 ki width
 fir, make phone port of it and use this ds approach
  in keyframes to see how well it works, and you might end up with situation written just below this: -->

<!-- debug this from start when closest variable is detacted
 right now the issue is
  let parts = uVar.substring(4).split("__");
  because the parts may content "input" so 
  let convertedSelector = chunks.map(token => {
  if (token.startsWith(".")) {
    let className = token.slice(1);
    if (!firstClassUsed) {
      firstClassUsed = true;
      return className;        // first class → no "__"
    }
    return "__" + className;   // later classes → "__"
  }
  if (token.startsWith("#")) {
    return token; // leave id as-is
  }
  return "___" + token; // tags → "___"
}).join("");

gets confused between if it is a class or tag so you end up with
input___input even when you have just "input"
so fix it without compromising on others
-->




<!-- workkkkkkkkkkkkkkkkkkkkkkkk karo ya---
 aab finalize function ko update karo dekho ager input ka width
 shai rha tha hai finalize ka execute hone ke baaad  matablab

 whai race condition ka issue hai -->
